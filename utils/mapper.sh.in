#!/bin/sh
######################################################################
#
# $Id$
#
# Given a DN, make sure it complies with our relative DN space.
# This script is for use by the MyProxy online CA for validating
# requests from the GridShib-CA.
#
# Returns 1 on error, 0 otherwise.
#
######################################################################

# Exit on any error
set -e

# Our relative DN
relativeDN="@OPENSSL_RELATIVE_DN@"

dn=$1
if test X"$dn" = X ; then
	# No DN given
	exit 1
fi

# Get unique portion of the DN
uniquePortion=`echo $dn | sed -e "s|${relativeDN}||"`

# Make sure unique portion is not empty string
if test X"$uniquePortion" = X ; then
    exit 1
fi

# Now append unique part to relative DN. Result should be identical to
# reuqested DN
validDN=${relativeDN}${uniquePortion}
if test "${validDN}" != "${dn}" ; then
    exit 1
fi
# All checks out
echo ${validDN}
exit 0
