<html>
<head>
<!-- $Id$ -->
<title>GridShib CA: MyProxy-based CA</title>
<!-- global style sheet -->
<link rel="stylesheet" type="text/css" href="/styles/global.css" />

<!-- local style sheet -->
<link rel="stylesheet" type="text/css" href="/styles/local.css" />
</head>
@DOC_HEADER@

This page has directions for configuring the GridShib-CA to use
a <a href="http://myproxy.ncsa.uiuc.edu">MyProxy</a>-based CA.
It has been tested with MyProxy version 3.5. The MyProxy server can be
running either on the same host as the GridShib-CA or a remote host.
<p>
If you elect to use a MyProxy CA instead of the default OpenSSL CA, it
is assumed you have some experience with Grid certificate
management and have access to a PKI infrastructure and know how to get
certificates. So these directions, out of necessity, skip over these
details which are specific to your local environment.
<p>
Note that you probably don't want to use the same MyProxy server for
GridShib-CA and anything else.  These directions assume a MyProxy
server dedicated to a GridShib-CA.  It's possible in theory to use it
for other things, but you'll need to figure out how to tweak the
configuration yourself.
<p>
<h2>Prerequisites</h2>
<ul>
<li>You need to have the IO::Net::SSL perl module installed on the
	GridShib-CA system (and it's prerequisite NET::SSLeay).
</ul>
<h2><a name="gridshibca-config">Configuring the GridShib CA to use
		MyProxy</a></h2>
You need to create a set of credentials for the GridShib CA to use
when contacting the MyProxy server. The DN of these credentials can
be whatever you want, just remember it for subsequent steps where it
will be referred to as the <i>GridShib-CA DN</i>. For the
purposes of these installation instructions, we will assume a DN of
"/C=US/O=NCSA-TEST/OU=User/CN=SP-Service", adjust them to match your
chosen DN.
<p>
Install the created credentials (certificate and key respectively) in
the following locations. (You can install them in an alternate
location, in which case you will need to adjust the MyProxyClientCert
and MyProxyClientKey parameters in gridshib-ca.conf as described
subsequently.)
<ul>
<li>@GRIDSHIB_CA_CONF_DIR@/myproxy-client-cert.pem
<li>@GRIDSHIB_CA_CONF_DIR@/myproxy-client-key.pem.
</ul>
You need to make sure they are owned by the user under which the
Apache httpd runs. Permissions should be as shown here:
<pre>
-rw-------  1 apache root 1387 Jun  2 16:24 myproxy-client-cert.pem
-rw-------  1 apache root 1679 Jun  2 16:24 myproxy-client-key.pem
</pre>
<p>
Next you need to edit the file
<i>@GRIDSHIB_CA_CONF_DIR@/gridshib-ca.conf</i> and modify the following
parameters:
<ul>
<li><b>caModule</b>: Change this setting
	to <i>GridShibCA::MyProxyCA</i>
<li><b>MyProxyHostname</b>: Set this value to the hostname where the
	MyProxy server is running
<li><b>MyProxyPort</b>: Set this value to the port number of the
	MyProxy server (7512 is the default)
<li><b>MyProxyClientCert</b>: Set this value to the path of the
	certificate to use to authenticate to the MyProxy server
<li><b>MyProxyClientKey</b>: Set this value to the path of the
	key to use to authenticate to the MyProxy server
</ul>
<h2><a name="myproxy-config">Configuring the MyProxy Server</a></h2>
On the MyProxy server system, do the following. These steps give the
GridShib-CA to request and receive any certificate from the MyProxy CA
with the mapapp program specifying which certificates are generated.
<ol>
<li>The MyProxy server must
      be <a href="http://grid.ncsa.uiuc.edu/myproxy/ca/">configured to act
              as a CA</a>
<li>In /etc/myproxy-server.config set authorized_retrievers to the
      GridShib-CA DN. For example:
<pre>
authorized_retrievers      "/C=US/O=NCSA-TEST/OU=User/CN=SP-Service"
</pre>
<li>In /etc/myproxy-server.config trusted_retrievers must include the
      GridShib-CA DN. For example:
<pre>
trusted_retrievers      "/C=US/O=NCSA-TEST/OU=User/CN=SP-Service"
</pre>
<li>In /etc/myproxy-server.config default_trusted_retrievers must
include the GridShib-CA DN. For example:
<pre>
default_trusted_retrievers      "/C=US/O=NCSA-TEST/OU=User/CN=SP-Service"
</pre>
<li>From the GridShib-CA system, copy the file
  "@GRIDSHIB_CA_CONF_DIR@/myproxy-mapapp.pl" to somewhere on
  the MyProxy server. It should be installed owned by root and with
  permissions 0700. For these directions we assume you installed it as
  "/usr/local/bin/myproxy-mapapp.pl".
	If you are running the myproxy server on
  the same system as the GridShib-CA you can just leave this file
  where it is and specify its path in the next step.
	If you did not specify --with-relative-dn during configuration,
	you will need to edit this file and set the value
	for <i>$namespace</i> to the correct relative DN for your MyProxy
	CA. This value must be in OpenSSL format
	(e.g. /C=US/O=NCSA-TEST/OU=User/).
<li>In /etc/myproxy-server.config set certificate_mapapp to the path
      of mapapp.pl. For example:
<pre>
certificate_mapapp        "/usr/local/bin/mapapp.pl"
</pre>
<li>If the MyProxy server is already running, restart the myproxy
server by killing it and restarting it in order to reload the
configuration. (Running "/etc/init.d/myproxy stop; /etc/init.d/myproxy
  start" should do it.)
</ol>

@DOC_FOOTER@
</html>
