#!@PERL@ -T -w
######################################################################
#
# $Id$
#
# This script serves as a welcome mat for users. It should be Shibboleth
# protected and it makes sure that REMOTE_USER is available before
# providing a link to invoke the "login" script.
#
######################################################################

print <<"EOF";
Content-type: text/html

<html>
<head>
  <title>GridShib CA Welcome</title>
  <META HTTP-EQUIV=\"Pragma\" CONTENT=\"no-cache\">
  <META HTTP-EQUIV=\"Expires\" CONTENT=\"-1\">
</head>
<body>

<table width=100%>
              <tr>
                <td id="gtlogo"><a href="http://www.globus.org/toolkit/"><img src="@GRIDSHIB_URL@/globustoolkit.gif" width="160" height="76" alt="The Globus Toolkit" /></a></td>
                <td id="head"><h1>GridShib CA</h1></td>
                <td id="shiblogo"><a href="http://shibboleth.internet2.edu/"><img src="@GRIDSHIB_URL@/Shibboleth-logo_RGB.jpg" height="76" alt="Shibboleth" /></a></td>
              </tr>
</table>
EOF
$user = $ENV{"REMOTE_USER"};
if (defined($user))
{
    print <<"EOF";
<center>
Welcome $user.
<p>
Your GridShib-CA DN will be /C=US/O=NCSA-TEST/OU=User/CN=$user
<p>
<form action=\"login\">
  <input type=\"submit\" value=\"Press here to generate and download Grid credential.\">
</form>
</center>
EOF
}
elsif (defined($ENV{"HTTP_SHIB_IDENTITY_PROVIDER"}))
{
    print <<"EOF";
We're sorry. Your origin site ($ENV{"HTTP_SHIB_IDENTITY_PROVIDER"})
is not releasing your identity to us, so we cannot proceed.
EOF
}
else
{
 print <<"EOF";
Cannot determine Shibboleth idenity or origin site.
It appears this script is not Shibboleth protected.
Please check configuration.
EOF
}

print <<"EOF";
</body>
</html>
EOF



