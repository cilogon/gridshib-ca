#!@PERL@ -T -w
######################################################################
#
# $Id$
#
# This script serves as a welcome mat for users. It should be Shibboleth
# protected and it makes sure that REMOTE_USER is available before
# providing a link to invoke the "login" script.
#
######################################################################

print "Content-type: text/html\n\n";
print "<html>\n";
print "<head>";
print "  <title>GridShib CA Welcome</title>\n";
print "  <META HTTP-EQUIV=\"Pragma\" CONTENT=\"no-cache\">\n";
print "  <META HTTP-EQUIV=\"Expires\" CONTENT=\"-1\">\n";
print "</head>";
print "\n\n<body>\n";
print <<"EOF";
<table width=100%>
              <tr>
                <td id="gtlogo"><a href="http://www.globus.org/toolkit/"><img src="/images/globustoolkit.gif" width="160" height="76" alt="The Globus Toolkit" /></a></td>
                <td id="head"><h1>GridShib CA</h1></td>
                <td id="shiblogo"><a href="http://shibboleth.internet2.edu/"><img src="/images/Shibboleth-logo_RGB.jpg" height="76" alt="Shibboleth" /></a></td>
              </tr>
</table>
EOF
$user = $ENV{"REMOTE_USER"};
if (defined($user))
{
    print "<center>\n";
    print "Welcome $user.<p>";
    print "Your GridShib-CA DN will be /C=US/O=NCSA-TEST/OU=User/CN=" . $user . "<p>\n";
    print "<form action=\"login\">\n";
    print "<input type=\"submit\" value=\"Press here to generate and download Grid credential.\">\n";
    print "</form>\n";
    print "</center>\n";
}
else
{
    if (defined($ENV{"HTTP_SHIB_IDENTITY_PROVIDER"})) {
	print "We're sorry. Your origin site (" . $ENV{"HTTP_SHIB_IDENTITY_PROVIDER"} . ") ";
	print "is not releasing your identity to us, so we cannot proceed.\n";
    }
    else
    {
	print "Cannot determine Shibboleth idenity or origin site.\n";
	print "It appears this script is not Shibboleth protected.\n";
	print "Please check configuration.\n";
    }
}
print "</body>\n\n";
print "</html>\n";


