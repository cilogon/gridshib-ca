#!/bin/sh
######################################################################
#
# This script is run by the deploy-test make target on the GridShib-CA
# test system to build and deploy the test GridShib-CA.
#
# $Id$
#
######################################################################
#
# Exit on any error

set -e

######################################################################

conf_opts="\
--with-gridshib-ca-dir-name=gridshib-ca-test-@PACKAGE_VERSION_STRING@ \
--with-globus-location=/usr/local/globus \
--with-openssl-path=/usr/bin/ \
--with-www-user=www-data \
"

echo "Running configure..."
echo "Options are: $conf_opts"

./configure ${conf_opts}

######################################################################

echo "Making..."
make

echo "Running tests..."
make test

echo "Installing..."
sudo make install

echo "Create CA credentials..."
sudo utils/create-openssl-ca.pl

echo "Running post-install tests..."
sudo make test-post-install

################################################################################

echo "Build and install complete."
exit 0
